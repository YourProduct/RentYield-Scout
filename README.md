# RentYield-Scout

Telegram бот, который раз в запуск проходит по обновлениям из указанных групп и
пересылает подходящие вакансии в ваш канал или группу.

## Возможности

- Считывает обновления из групп и каналов, где бот состоит и имеет права на чтение.
- Фильтрует посты по ключевым словам (по умолчанию: Product Manager, Program Manager,
  AI Product Manager, Head of AI, AI Tech Lead).
- Пересылает подходящие сообщения в целевой чат через `copyMessage`, сохраняя оригинальное
  форматирование.
- Ведёт локальное состояние (последний `update_id` и список уже пересланных сообщений),
  чтобы не создавать дубликатов между запусками.

## Подготовка

1. Создайте бота через [@BotFather](https://t.me/BotFather) и получите токен.
2. Добавьте бота во все источники (каналы/группы из [папки с вакансиями](https://t.me/addlist/drqCvy7Zqgw5NDVi))
   и выдайте ему права администратора, чтобы он получал обновления.
3. Создайте свой целевой канал/группу и добавьте туда бота с правами на публикацию.
4. Склонируйте репозиторий и установите зависимости:

   ```bash
   pip install -r requirements.txt
   ```

## Конфигурация

Создайте файл `.env` на основе шаблона `.env.example`:

```bash
cp .env.example .env
```

Заполните значения:

- `BOT_TOKEN` — токен из @BotFather.
- `TARGET_CHAT_ID` — ID или `@username` чата, куда пересылать вакансии.
- `SOURCE_CHAT_IDS` — список ID или `@username` источников, разделённых запятыми.
  Узнать numeric ID можно через сторонние боты (например, `@username_to_id_bot`) или из логов,
  когда бот уже добавлен в чат. Для каналов ID обычно начинается с `-100`.
- Опционально `KEYWORDS` — переопределите ключевые слова через запятую.
- Опционально `STATE_FILE` — путь до файла состояния (по умолчанию `state/state.json`).

> ⚠️ Файл состояния не хранится в репозитории. Скрипт создаст директорию автоматически.

## Запуск

1. Убедитесь, что `.env` заполнен.
2. Выполните команду:

   ```bash
   python vacancy_bot.py
   ```

   Скрипт получит накопившиеся обновления, отберёт релевантные сообщения и пересылает их в целевой чат.

### Режим проверки

Для тестового запуска без отправки сообщений используйте `--dry-run`:

```bash
python vacancy_bot.py --dry-run
```

### Параметры запуска

- `--state-file` — переопределяет путь к файлу состояния. Можно также указать через переменную `STATE_FILE`.

## Рекомендации по эксплуатации

- Запускайте скрипт по расписанию (cron, Task Scheduler) хотя бы раз в сутки. Telegram будет
  хранить обновления, пока вы их не заберёте.
- Если нужно, чтобы бот обрабатывал больше ключевых слов, добавьте их в переменную `KEYWORDS`.
- Логи выводятся в stdout; при необходимости перенаправьте их в файл.
- При переносе на другой сервер скопируйте также файл состояния, чтобы сохранить историю обновлений.

## Ограничения

- Бот получает обновления только из чатов, где он присутствует и имеет права.
- Для приватных каналов его необходимо пригласить вручную.
- Скрипт использует HTTP запросы к Bot API и не предназначен для постоянного стрима сообщений.
